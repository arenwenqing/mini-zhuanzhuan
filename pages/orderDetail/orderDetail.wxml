<!--pages/orderDetail/orderDetail.wxml-->
<view class="container">
  <mp-navigation-bar title="{{topTitle}}" color='#ffffff' background='linear-gradient(86deg, #FF706B 0%, #F8052B 100%)'></mp-navigation-bar>

  <!-- 上部分模块 -->
  <!--展示红包的相关逻辑-->
  <view wx:if="{{showRedPackageFlag}}" class="redpacke-show">
      <view class="redpacke-show-img">
        <image src="https://cdn.tuanzhzh.com/share/1%402x.png" class="red-image"></image>
        <view class="redpacke-show-text">您获得<text class="redpacke-show-num-text">{{orderData.product.baseCashback}}</text>元红包</view>
        <text class="redpacke-show-text redpacke-show-text2">邀请好友下单</text>
        <view class="redpacke-show-explain">
          <text>最多可得红包</text>
        </view>
        <view class="redpacke-shaow-max">{{orderData.product.finalCashback}}</view>
      </view>
      <view class="redpacke-btn-wrapper">
        <button class="share-btn-style share-btn-style2" disabled="{{directlyBtnStatus}}" catchtap="receiveDialog">直接拿走</button>
        <button class="share-btn-style" disabled="{{ifCanClick}}" catchtap="skipMypage">
          翻倍我的红包
        </button>
      </view>
      <view class="redpacke-btn-instructions">
        <text class="redpacke-instructions-text">直接拿走</text>
        <view class="redpacke-tip-content" wx:if="{{showTip}}">
          <view class="tip-item">1 红包领取时效为24小时，到期未领取的红包将被回收。</view>
          <view class="tip-item">2 领取红包后，该红包将于5分钟内到达您的微信零钱，请注意查收。</view>
          <view class="tip-item-last">本使用说明的最终解释权归团团转所有</view>
          <image src="/pages/images/triangle2.png" class="redpacke-triangle"></image>
          <image src='/pages/images/guanbi.png' class="redpacke-close" catchtap="closeTip"></image>
        </view>
        <image src='/pages/images/zhujie.png' class="redpacke-zhujie" catchtap="showTipFun" />
        <text class="redpacke-instructions-text"></text>
      </view>
    </view>
  <view class="order-top">
    <order-top-intro orderData="{{orderData}}"></order-top-intro>
    <!-- 订单已出库提示 -->
    <view wx:if="{{showHaveOutbound}}" class="order-outbound">
      您的订单已出库，正在打包中
    </view>
    
    <!--订单的地址信息展示-->
    <view wx:if="{{orderStatusDescName !== ''}}" class="detail-address-message">
      <view class="detail-address-item">
        {{orderData.receiveAddress.provinceName + orderData.receiveAddress.cityName +  orderData.receiveAddress.districtName + orderData.receiveAddress.detail}}
      </view>
      <view class="detail-address-item">
        <text class="detail-address-item-name">{{orderData.receiveAddress.receiveUsername}}</text>
        <text>{{orderData.receiveAddress.receivePhoneNum}}</text>
      </view>
    </view>
    <!-- 已发货，快递信息 -->
    <order-express-info
      wx:if="{{showExpressInfo && orderData.express.expressNumber}}" orderData="{{orderData}}"
    ></order-express-info>
    <!-- 订单编号、订单金额、包装规格 -->
    <order-reference orderData="{{orderData}}"></order-reference>
  </view>
  <!--商品评价-->
  <view wx:if="{{orderData.orderStatus.code === 504 || orderData.orderStatus.code === 601}}" class="goods-evaluation-wrapper">
      <view class="evaluation-title">商品评价</view>
      <view class="evaluation-level evaluation-level-first">
        <text class="evaluation-level-title">商品评价</text>
        <view wx:for="{{goodsStar}}" wx:key="index">
          <image wx:if="{{goodsEvaluation >= index + 1}}" src='../images/big-star.png' class="evaluation-goods-start-style" catchtap="goodsEvaluationClick" data-index="{{index + 1}}" data-type="goodsEvaluation"  />
          <image wx:else src='../images/star-gray.png' class="evaluation-goods-start-style" catchtap="goodsEvaluationClick" data-type="goodsEvaluation" data-index="{{index + 1}}"  />
        </view>
      </view>
      <view class="evaluation-level">
        <text class="evaluation-level-title">购物体验</text>
         <view wx:for="{{goodsStar}}" wx:key="index">
          <image wx:if="{{shoppingExperience >= index + 1}}" src='../images/big-star.png' class="evaluation-goods-start-style" catchtap="goodsEvaluationClick" data-index="{{index + 1}}" data-type="shoppingEvaluation" />
          <image wx:else src='../images/star-gray.png' class="evaluation-goods-start-style" catchtap="goodsEvaluationClick" data-type="shoppingEvaluation" data-index="{{index + 1}}"  />
        </view>
      </view>
      <view class="evaluation-level">
        <text class="evaluation-level-title">使用评价</text>
         <view wx:for="{{goodsStar}}" wx:key="index">
          <image wx:if="{{experienceEvaluation >= index + 1}}" src='../images/big-star.png' class="evaluation-goods-start-style" catchtap="goodsEvaluationClick" data-index="{{index + 1}}" data-type="logisticsEvaluation"  />
          <image wx:else src='../images/star-gray.png' class="evaluation-goods-start-style" catchtap="goodsEvaluationClick" data-type="logisticsEvaluation" data-index="{{index + 1}}"  />
        </view>
      </view>
      <view class="evaluation-bottom-style">
        <text class="evaluation-bottom-left-text">签收24小时候将自动评价</text>
        <view wx:if="{{orderData.orderStatus.code === 504}}" class="evaluation-bottom-right-btn">
          <text class="evaluation-bottom-right-btn-text" catchtap="submitEvaluation">提交评价</text>
        </view>
        <view wx:else class="evaluation-bottom-right-btn2">
          <text class="evaluation-bottom-right-btn-text">提交评价</text>
        </view>
      </view>
    </view>
  <!-- 下部分模块 -->
  <view class="order-content">
    <!-- 商品结算页-参团成功，拼团倒计时 code:0 展示-->
    <order-settlement-countdown
      wx:if="{{orderStatusCode === 101}}"
      orderData="{{orderData}}"
      addressInfo="{{addressInfo}}"
      id="orderSettlement"
    ></order-settlement-countdown>
    <view wx:if="{{tipMessage}}" class="tip-message-wrapper">
      <text class="tip-message-text">{{tipMessageText}}</text>
    </view>
    <!-- 支付成功，拼团倒计时...剩余xx时间结束--待成团展示 -->
    <!-- <order-content-title
      wx:if="{{orderStatusCode === 4}}"
      orderData="{{orderData}}"
    ></order-content-title> -->

    <!-- 拼团标题提示(根据不同状态展示不同标题提示) -->
    <view wx:if="{{showOrderStatusDescName}}" class="group-title-hint">
      <view>{{orderStatusDescName}}</view>
    </view>  
    <!-- 申请退货逻辑 -->
    <view wx:if="{{showOnlyReimburse || showOnlySalesReturn}}">
      <view wx:if="{{ifShowEvaluationText}}" class="receiveing-title">{{evaluationText}}</view>
      <view class="apply-refund">
        <text class="apply-refund-title">{{ showOnlyReimburse ? '商品退款' : '商品退货'}}</text>
        <view class="refund-operation-btn">
          <view class="reimburse"
          wx:if="{{showOnlyReimburse}}"
          catchtap="reimburse">申请退款</view>
          <view wx:if="{{showOnlySalesReturn}}" class="sales-return" catchtap="salesReturn">申请退货</view>
        </view>
      </view>
    </view>
  </view>

  <mp-dialog title="添加收货地址" bindbuttontap="closeAddressTip" buttons="{{buttonArray}}" mask="true" mask-closable="false" show="{{addAddressDialog}}">
  </mp-dialog>
  <mp-dialog title="{{payText}}" bindbuttontap="closePayTip" buttons="{{payArray}}" mask="true" mask-closable="false" show="{{payfailShow}}">
  </mp-dialog>
  <!-- 联系客服二维码弹窗 -->
  <wait-qr-code visibile="{{isVisibleCallServicer}}"></wait-qr-code>
  <!-- 直接拿走弹窗 -->
  <receive-dialog showDialog="{{showReceiveDialog}}" orderId="{{orderId}}" orderData="{{orderData}}" bind:takePackage="takePackage" bind:takeMoney="takeMoney"></receive-dialog>
  <!--退款弹窗-->
  <refund-money orderId="{{orderId}}" orderData="{{orderData}}" showRefundMoneyDialog="{{showRefundMoneyDialog}}" id="refundMoney" bind:payFun="getRefundMessage" bind:reloadDetail="reloadDetail"></refund-money>

  <!-- 底部操作按钮 -->
  <operation-guide
    id='bottomBtn'
    class="bottom-operation-btn"
    bottomBtnName="{{bottomBtnName}}"
    bindclickOperationBtn="clickPerationBtn"
    bindcountdown="onCountDown"
    currentStatus="{{currentStatus}}"
  ></operation-guide>
</view>
